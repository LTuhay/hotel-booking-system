2024-07-30 00:00:52.419 -03:00 [INF] User profile is available. Using 'C:\Users\loren\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2024-07-30 00:00:52.820 -03:00 [INF] Now listening on: https://localhost:7288
2024-07-30 00:00:52.823 -03:00 [INF] Now listening on: http://localhost:5124
2024-07-30 00:00:52.828 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2024-07-30 00:00:52.830 -03:00 [INF] Hosting environment: Development
2024-07-30 00:00:52.831 -03:00 [INF] Content root path: C:\Users\loren\source\repos\Hotel Booking System\HotelBookingSystem.Api
2024-07-30 00:00:53.855 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7288/swagger/index.html - null null
2024-07-30 00:00:54.559 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7288/swagger/index.html - 200 null text/html;charset=utf-8 709.056ms
2024-07-30 00:00:54.616 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7288/_framework/aspnetcore-browser-refresh.js - null null
2024-07-30 00:00:54.617 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7288/_vs/browserLink - null null
2024-07-30 00:00:54.635 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7288/_framework/aspnetcore-browser-refresh.js - 200 13780 application/javascript; charset=utf-8 19.1774ms
2024-07-30 00:00:54.768 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7288/_vs/browserLink - 200 null text/javascript; charset=UTF-8 151.4728ms
2024-07-30 00:00:54.923 -03:00 [INF] Request starting HTTP/2 GET https://localhost:7288/swagger/v1/swagger.json - null null
2024-07-30 00:00:55.355 -03:00 [INF] Request finished HTTP/2 GET https://localhost:7288/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 432.6883ms
2024-07-30 00:01:04.159 -03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7288/api/booking/15 - null null
2024-07-30 00:01:04.395 -03:00 [INF] Executing endpoint 'HotelBookingSystem.Api.Controllers.BookingController.CancelBooking (HotelBookingSystem.Api)'
2024-07-30 00:01:04.439 -03:00 [INF] Route matched with {action = "CancelBooking", controller = "Booking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CancelBooking(Int32) on controller HotelBookingSystem.Api.Controllers.BookingController (HotelBookingSystem.Api).
2024-07-30 00:01:07.098 -03:00 [INF] Executing command: SELECT "b"."BookingId", "b"."CheckInDate", "b"."CheckOutDate", "b"."HotelId", "b"."RoomId", "b"."SpecialRequests", "b"."TotalPrice", "b"."UserId", "p"."PaymentId", "p"."Amount", "p"."BookingId", "p"."PaymentDate", "p"."PaymentMethod", "p"."Status", "h"."HotelId", "h"."Address", "h"."Amenities", "h"."CityId", "h"."CreatedAt", "h"."Description", "h"."HotelType", "h"."Name", "h"."Owner", "h"."StarRating", "h"."ThumbnailUrl", "h"."UpdatedAt", "u"."UserId", "u"."Address", "u"."City", "u"."Country", "u"."DateOfBirth", "u"."Email", "u"."FirstName", "u"."LastName", "u"."PasswordHash", "u"."PhoneNumber", "u"."Role", "r"."RoomId", "r"."AdultCapacity", "r"."ChildCapacity", "r"."CreatedAt", "r"."DiscountedPrice", "r"."FeaturedDeal", "r"."HotelId", "r"."ImagesUrl", "r"."PricePerNight", "r"."RoomType", "r"."UpdatedAt"
FROM "Bookings" AS "b"
LEFT JOIN "Payments" AS "p" ON "b"."BookingId" = "p"."BookingId"
INNER JOIN "Hotels" AS "h" ON "b"."HotelId" = "h"."HotelId"
INNER JOIN "Users" AS "u" ON "b"."UserId" = "u"."UserId"
INNER JOIN "Rooms" AS "r" ON "b"."RoomId" = "r"."RoomId"
WHERE "b"."BookingId" = @__bookingId_0
LIMIT 1
2024-07-30 00:01:07.148 -03:00 [INF] Executed DbCommand (42ms) [Parameters=[@__bookingId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT "b"."BookingId", "b"."CheckInDate", "b"."CheckOutDate", "b"."HotelId", "b"."RoomId", "b"."SpecialRequests", "b"."TotalPrice", "b"."UserId", "p"."PaymentId", "p"."Amount", "p"."BookingId", "p"."PaymentDate", "p"."PaymentMethod", "p"."Status", "h"."HotelId", "h"."Address", "h"."Amenities", "h"."CityId", "h"."CreatedAt", "h"."Description", "h"."HotelType", "h"."Name", "h"."Owner", "h"."StarRating", "h"."ThumbnailUrl", "h"."UpdatedAt", "u"."UserId", "u"."Address", "u"."City", "u"."Country", "u"."DateOfBirth", "u"."Email", "u"."FirstName", "u"."LastName", "u"."PasswordHash", "u"."PhoneNumber", "u"."Role", "r"."RoomId", "r"."AdultCapacity", "r"."ChildCapacity", "r"."CreatedAt", "r"."DiscountedPrice", "r"."FeaturedDeal", "r"."HotelId", "r"."ImagesUrl", "r"."PricePerNight", "r"."RoomType", "r"."UpdatedAt"
FROM "Bookings" AS "b"
LEFT JOIN "Payments" AS "p" ON "b"."BookingId" = "p"."BookingId"
INNER JOIN "Hotels" AS "h" ON "b"."HotelId" = "h"."HotelId"
INNER JOIN "Users" AS "u" ON "b"."UserId" = "u"."UserId"
INNER JOIN "Rooms" AS "r" ON "b"."RoomId" = "r"."RoomId"
WHERE "b"."BookingId" = @__bookingId_0
LIMIT 1
2024-07-30 00:01:07.721 -03:00 [INF] Executed action HotelBookingSystem.Api.Controllers.BookingController.CancelBooking (HotelBookingSystem.Api) in 3272.2403ms
2024-07-30 00:01:07.725 -03:00 [INF] Executed endpoint 'HotelBookingSystem.Api.Controllers.BookingController.CancelBooking (HotelBookingSystem.Api)'
2024-07-30 00:01:07.760 -03:00 [WRN] Invalid operation.
System.InvalidOperationException: Cannot delete booking with an associated payment.
   at HotelBookingSystem.Application.Services.BookingService.CancelBookingAsync(Int32 bookingId) in C:\Users\loren\source\repos\Hotel Booking System\HotelBookingSystem.Application\Services\BookingService.cs:line 127
   at HotelBookingSystem.Api.Controllers.BookingController.CancelBooking(Int32 bookingId) in C:\Users\loren\source\repos\Hotel Booking System\HotelBookingSystem.Api\Controllers\BookingController.cs:line 39
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at HotelBookingSystem.Api.Middlewares.ErrorHandlingMiddleware.InvokeAsync(HttpContext httpContext) in C:\Users\loren\source\repos\Hotel Booking System\HotelBookingSystem.Api\Middlewares\ErrorHandlingMiddleware.cs:line 20
2024-07-30 00:01:07.852 -03:00 [INF] HTTP DELETE /api/booking/15 responded 400 in 3677.1857 ms
2024-07-30 00:01:07.860 -03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7288/api/booking/15 - 400 null application/json 3701.2253ms
